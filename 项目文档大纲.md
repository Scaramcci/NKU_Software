# 渔场管理系统项目文档大纲
## 1. 项目概述
### 1.1 项目简介
- 项目背景
- 项目目标
- 主要功能
- 项目特色

### 1.2 项目范围
- 功能范围
- 技术范围
- 用户群体
- 系统边界

### 1.3 项目团队
- 团队成员
- 角色分工
- 联系方式

## 2. 需求分析
### 2.1 业务需求
- 业务流程分析
- 功能需求列表
- 非功能需求
- 约束条件

### 2.2 用户需求
- 用户角色定义
- 用户故事
- 用例图
- 用户界面需求

### 2.3 系统需求
- 性能需求
- 安全需求
- 可靠性需求
- 兼容性需求

## 3. 系统设计
### 3.1 系统架构
- 整体架构图
- 技术架构
- 部署架构
- 数据架构

### 3.2 前端设计
- 前端技术栈
- 组件设计
- 页面结构
- 状态管理
- 路由设计

### 3.3 后端设计
- 微服务架构:本项目采用基于 Spring Cloud 的微服务架构设计，核心思想是将不同业务模块拆分为独立运行的服务，如用户管理、设备控制、渔场监控和预警处理等。每个服务通过 Eureka 注册中心进行注册和发现，服务之间通过服务名进行通信，并通过 Spring Cloud Gateway 实现统一的请求入口与路由分发，形成去中心化、高可用的服务体系。
- 服务划分:系统将后端功能划分为七个微服务模块：common 为通用模块，提供工具类与统一封装；registry 为注册中心，负责服务注册发现；gateway 为网关，统一路由并实现权限拦截；user-service 负责用户注册登录和权限控制；farm-service 管理渔场基础与环境信息；device-service 管理设备信息与远程控制；alarm-service 实现预警阈值配置与告警记录处理。
- API设计:所有后端服务均采用 RESTful API 设计风格，接口统一以 /api 开头，采用动词-资源名方式定义路径。请求参数支持 JSON 格式传输，响应体统一使用 Result<T> 包装，便于前端处理。接口文档采用 Swagger 自动生成，方便前后端联调与测试。部分敏感接口要求登录后携带 JWT Token，通过网关统一校验身份权限。
- 数据库设计:系统采用 MySQL 作为关系型数据库，各微服务模块拥有独立数据库 schema，实现业务隔离和分库分表的基础。采用 Spring Data JPA 进行数据库操作，通过实体类与注解自动建表，字段校验逻辑前后端一致。数据结构设计以高内聚、低冗余为原则，确保数据一致性与可维护性。
- 安全设计:系统采用 Spring Security + JWT 实现用户身份认证与权限控制。用户成功登录后获得 Token，后续请求需在请求头携带 Authorization 字段进行身份验证。所有鉴权逻辑统一放置在 gateway 层的 JwtFilter 中，实现对核心业务接口的访问保护。系统内区分普通用户和管理员角色，对权限敏感的操作仅允许管理员访问，提升系统安全性。

### 3.4 部署设计
- 宝塔服务器部署
#### 3.4.1 部署架构
- **生产环境架构**：采用前后端分离部署，前端静态资源部署在Nginx服务器，后端微服务部署在Docker容器中
- **服务器配置**：
  ### 三、关键指标总结 | **维度** | **具体配置** | |----------------|---------------------------------------| | **CPU 型号** | Intel(R) Xeon(R) Platinum 8255C @ 2.50GHz | | **CPU 架构** | x86_64（64位），支持32/64位操作模式 | | **核心/线程** | 2 物理核心 / 2 线程（每核心1线程） | | **缓存配置** | L1d: 64 KiB×2，L1i: 64 KiB×2，L2: 8 MiB×2，L3: 35.8 MiB | | **NUMA 节点** | 1个（节点0包含CPU 0、1） | | **虚拟化** | Hypervisor: KVM，虚拟化类型: 全虚拟化 |

#### 3.4.2 宝塔服务器部署步骤
1. **环境准备**
   - 安装宝塔面板：`yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh`
   - 安装必要组件：Nginx 1.20、MySQL 8.0、Redis 6.2、Docker 20.10
   - 配置安全组：开放80、443、8080、3000、11747端口

2. **前端部署**
   - 构建前端项目：`cd frontend && npm run build`
   - 配置Nginx：
     ```nginx
     server {
       listen 3000;
       server_name www.yyhrp.com;
       root /www/wwwroot/fishfarm/frontend;
       index index.html;
       location /api/ {
         proxy_pass http://127.0.0.1:3000/;
       }
     }
     ```

3. **后端部署**
   - 安装Docker Compose：`curl -L "https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose`
   - 编写docker-compose.yml配置微服务集群
   - 启动服务：`docker-compose up -d`

4. **数据库部署**
   - 通过宝塔面板创建数据库并导入初始数据
   - 配置主从复制提高可用性

5. **监控配置**
   - 安装宝塔监控插件
   - 配置服务器资源监控告警
   - 部署ELK日志收集分析系统
## 4. 技术规范
### 4.1 开发规范
- 代码规范
- 命名规范
- 注释规范
- Git使用规范

### 4.2 技术选型
- 前端技术栈
  - React.js
  - Ant Design
  - Redux
  - ECharts
- 后端技术栈
  - Spring Boot
  - Spring Cloud
  - Spring Security + JWT
  - MySQL
  - Redis

### 4.3 开发工具
- IDE推荐
- 版本控制
- 构建工具
- 测试工具

## 5. 功能模块详细设计
### 5.1 用户管理模块
- **功能描述**：负责系统用户的注册、登录、权限分配和信息管理
- **核心功能**：
  - 用户注册：支持手机号/邮箱注册，包含验证码验证
  - 用户登录：支持账号密码登录
  - 权限管理：基于RBAC模型的权限控制，支持角色创建和权限分配
  - 用户信息管理：个人资料修改、密码重置、账号状态管理
- **数据模型**：
  ```
  User(id, username, password, email, phone, status, create_time, update_time)
  Role(id, name, description, create_time)
  Permission(id, name, url, method, description)
  UserRole(user_id, role_id)
  RolePermission(role_id, permission_id)
  ```
- **API接口**：
  - POST /api/users/register - 用户注册
  - POST /api/users/login - 用户登录
  - GET /api/users/{id} - 获取用户信息
  - PUT /api/users/{id} - 更新用户信息
  - POST /api/roles - 创建角色
  - POST /api/roles/{id}/permissions - 分配权限

### 5.2 渔场管理模块
- **功能描述**：实现渔场信息的管理和环境数据的监控
- **核心功能**：
  - 渔场信息管理：渔场基本信息CRUD、位置地图标记
  - 环境数据监控：实时水质数据展示（水温、pH值、溶氧量等）
  - 视频监控：实时视频流播放、历史视频回放
  - 渔场报表：生成水质、产量等数据报表
- **数据模型**：
  ```
  Farm(id, name, location, area, type, owner_id, create_time)
  FarmDevice(farm_id, device_id)
  WaterQualityData(id, farm_id, temperature, ph, oxygen, turbidity, salinity, collect_time)
  ```
- **关键界面**：
  - 渔场列表页：展示所有渔场基本信息和状态
  - 渔场详情页：展示渔场详细信息、实时数据和视频监控
  - 数据报表页：展示历史数据趋势图表

### 5.3 设备管理模块
- **功能描述**：管理渔场各类监测和控制设备
- **核心功能**：
  - 设备注册：新增设备并关联到指定渔场
  - 设备状态监控：实时展示设备在线状态和运行参数
  - 设备控制：远程控制设备开关、参数调节
  - 设备维护：设备故障报警、维护记录管理
- **数据模型**：
  ```
  Device(id, name, type, model, serial_number, status, farm_id, install_time)
  DeviceData(id, device_id, data, collect_time)
  DeviceCommand(id, device_id, command, status, send_time, execute_time)
  ```
- **通信协议**：
  - MQTT协议：设备与服务器之间的消息通信
  - CoAP协议：低功耗设备数据传输
  - HTTP协议：设备配置和管理接口

### 5.4 预警系统模块
- **功能描述**：对渔场异常情况进行实时监测和预警
- **核心功能**：
  - 预警规则配置：设置各类指标的正常范围和预警阈值
  - 实时监控：持续监测水质、设备状态等关键指标
  - 预警通知：通过短信、邮件、系统消息推送预警信息
  - 历史记录：预警事件查询和统计分析
- **预警类型**：
  - 水质预警：pH值异常、溶氧量低、水温异常等
  - 设备预警：设备离线、运行异常、电量低等
  - 安全预警：非法入侵、区域越界等
- **处理流程**：
  ```
  数据采集 → 指标判断 → 触发预警 → 通知发送 → 处理记录 → 预警解除
  ```

### 5.5 数据分析模块
- **功能描述**：对渔场运营数据进行统计分析和可视化展示
- **核心功能**：
  - 数据统计：产量统计、水质指标统计、设备运行统计
  - 趋势分析：关键指标变化趋势、同比环比分析
  - 报表生成：自定义报表生成
  - 数据可视化：使用折线图、柱状图、饼图等展示数据
- **分析维度**：
  - 时间维度：日/周/月/季度/年统计
  - 空间维度：单个渔场/区域/全系统统计
  - 指标维度：单项指标/多指标对比分析
- **技术实现**：
  - 前端可视化：ECharts.js实现各类图表
  - 数据处理：采用Spark进行离线数据计算
  - 数据存储：使用ClickHouse作为分析型数据库

## 6. 数据库设计
### 6.1 数据库概述
- 数据库选型： 本系统选用 MySQL 作为主要关系型数据库，具备成熟的事务处理能力、稳定的性能表现和良好的兼容性，适合中小型分布式服务部署。

-数据库架构： 每个微服务模块（如 user-service、device-service 等）拥有独立的 schema，确保服务之间数据隔离、结构清晰。所有服务共用一套数据库服务器，也可根据负载进行分布式部署。

-数据分布策略： 采用垂直拆分策略，根据业务模块分库（逻辑/物理），避免数据表之间的耦合，降低系统复杂度，提高查询效率和维护性。

### 6.2 数据表设计
- 用户相关表： 包含用户 ID、用户名、密码、角色、注册时间等字段，服务于用户注册登录与权限控制模块。
- 渔场相关表： 存储渔场的名称、地址、所属管理员 ID 等信息，便于绑定渔场与管理权限。
- 设备相关表： 记录设备编号、状态、类型、所属渔场等信息，支持设备控制、状态上报等功能。
- 监控数据表： 实时或定时记录水质相关参数，包括水温、pH 值、溶解氧等，用于可视化和分析。
- 预警相关表： 包含预警阈值设置表与预警记录表，便于系统判断是否报警、记录历史告警事件。

### 6.3 数据字典
-表结构说明：
每张表使用自增主键 ID 作为主键；
表名采用小写+下划线命名法，符合数据库规范；
字段设计尽量保持原子性，避免冗余。

-字段定义：
user 表字段包括：id (BIGINT)、username (VARCHAR)、password (VARCHAR)、role (VARCHAR)、create_time (DATETIME)；
device 表字段包括：id、device_code、status、farm_id；
environment_data 表字段包括：id、temperature、ph、oxygen、record_time、farm_id；
所有字段在实体类中通过注解（如 @Column）精确定义类型和限制。

-索引设计：
所有主键字段自动创建主键索引；
对于频繁查询的字段（如 username、device_code）建立唯一索引；
时间戳类字段（如 record_time）建立联合索引提升查询性能。

-约束条件：
用户名 username 不允许为空，且唯一；
外键字段如 farm_id 建立外键约束，保持主子表完整性；
部分字段（如温度、pH）允许为空，用于处理传感器失效场景。

## 7. 开发指南
### 7.1 环境搭建
- 开发环境要求：
JDK 1.8 及以上版本
Maven 3.6+
MySQL 8.0
Node.js & npm（前端）
-依赖安装：
项目使用 Maven 统一管理依赖，通过命令 mvn clean install 可自动下载依赖库，建议首次构建使用 mvn install -U 强制更新。
-配置说明：
每个模块内配置文件 application.yml 需根据本地 MySQL 账号密码修改；服务端口需避免冲突。
-启动步骤：
启动 registry 服务（注册中心）
启动 gateway 服务（网关）
启动各业务微服务（如 user、device、farm、alarm）
前端在 frontend 中执行 npm install && npm start

### 7.2 前端开发指南
- 项目结构说明：
components/：通用 UI 组件
pages/：页面视图文件
services/：API 请求封装
utils/：工具类方法

- 组件开发规范：
每个组件需具备清晰的 props 定义和样式分离；推荐使用函数式组件和 Hooks API。

- 样式管理：
统一使用 Ant Design + less 管理样式，可使用 styled-components 作为补充方案。

- 状态管理：
使用 Redux Toolkit 管理跨组件共享状态，局部状态用 useState。

- 调试技巧：
使用浏览器 DevTools 断点调试 + React Developer Tools 插件辅助查看组件状态和 props。

### 7.3 后端开发指南
- 微服务开发：
每个服务单独构建、单独部署，遵循 Controller-Service-Repository 分层原则，接口通过注解声明。

-数据库操作：
使用 Spring Data JPA 实现 ORM 映射，通过 Repository 接口封装基本增删改查，复杂查询使用 @Query。

-API 开发：
接口使用 REST 风格，统一响应格式封装为 Result<T>，通过 @RestController 提供服务。

-单元测试：
建议为业务逻辑编写 JUnit 单元测试方法，验证边界输入、异常处理等。

-集成测试：
使用 Postman、Swagger UI 或 MockMVC 进行全流程测试，保证模块兼容性与稳定性。

### 7.4 版本控制
- Git工作流：
使用 Git Flow 开发模型，主要分支包括 main（发布）、dev（开发）、feature/xxx（功能）分支。

- 分支管理：
开发新功能从 dev 拉出 feature 分支，功能完成后合并回 dev，再由 dev 合并至 main 发布。

- 代码审查：
每次合并前需提交 Pull Request（PR），进行代码审查，确保风格一致、无安全漏洞。

- 发布流程：
发布版本打 tag 记录（如 v1.0.0），并上传部署脚本与版本说明文档，保障回滚能力。

## 8. 部署运维
### 8.1 部署架构
系统采用分布式部署方式，registry 注册中心和 gateway 网关部署在边缘节点，用户访问入口集中；各微服务部署在内网或容器中，通过服务注册实现动态扩容；推荐结合 Docker 进行容器化部署，未来可升级为 Kubernetes 管理集群。

### 8.2 部署指南
- 环境准备： 安装 JDK、Maven、MySQL，并初始化数据库；

- 部署步骤：
修改各服务 application.yml 配置文件
执行 mvn clean install 构建所有模块
依次运行注册中心、网关和各业务微服务
前端运行 npm install && npm run build 部署到 Nginx

- 配置文件：
每个模块配置文件中应确保端口不冲突，数据库连接正确。

- 启动脚本：
可编写 Shell 脚本实现一键启动所有服务，提升上线效率。

### 8.3 运维监控
- 系统监控： 集成 Spring Boot Actuator 提供健康检查、应用信息等监控接口；

- 日志管理： 日志写入本地 logs 目录，可结合 ELK（Elasticsearch + Logstash + Kibana）系统实现集中日志分析；

- 性能监控： 推荐使用 Prometheus + Grafana 进行 JVM、服务请求、数据库连接等性能指标的可视化监控；

- 故障处理： 建议配置邮件或企业微信报警机制，一旦接口异常或 CPU 超载可快速通知运维人员。

### 8.4 备份恢复
- 数据备份策略： 使用 mysqldump 工具每日定时备份数据库到本地并推送至远程存储；

- 备份验证： 每周定期对备份文件进行完整性与可恢复性校验；

- 恢复流程： 在系统故障或误删数据情况下，可通过脚本快速导入 .sql 文件恢复数据；

- 灾难恢复： 建议制定完整的灾备方案，如双机热备、多节点部署等，确保业务高可用性。
## 9. 用户手册
### 9.1 系统介绍
- **功能概述**：渔场管理系统是一套集渔场监控、设备管理、数据分析和预警于一体的综合管理平台，支持多角色协同管理，帮助渔场管理者提高生产效率和管理水平。
- **使用流程**：
  ```
  用户登录 → 渔场选择 → 数据监控 → 设备管理 → 报表查看
  ```
- **注意事项**：
  - 系统支持Chrome、Firefox、Edge等现代浏览器，建议使用Chrome 80+版本
  - 部分高级功能需要管理员权限才能使用
### 9.2 操作指南
#### 9.2.1 登录注册
1. **系统登录**
   - 打开系统网址，进入登录页面
   - 输入用户名和密码
   - 点击"登录"按钮
   - 可选：勾选"记住我"保持登录状态
#### 2. **系统注册**  
若用户无账号，可在登录页面点击“注册”按钮进入注册流程，具体步骤如下：  


##### **（1）填写注册信息**  
- **基本信息**：  
  - 用户名：长度6-20位，由字母、数字或下划线组成（如“user_123”），需唯一且不可重复。  
  - 密码：长度8-20位，需包含大小写字母、数字及特殊符号（如“P@ssw0rd”），输入后需再次确认密码。    
  - 邮箱地址：需填写有效邮箱地址，用于接收系统通知或账号激活，需填写正确格式（如“example@domain.com”）。  

##### **（2）提交注册**  
- 点击“注册”按钮，系统校验信息：  
  - 若信息格式错误（如用户名已存在、密码复杂度不足），页面提示具体错误（如“用户名已被注册，请更换”），需修改后重新提交。  
  - 若信息无误，系统生成账号并跳转至登录页面，提示“注册成功，请登录”。  

#### 9.2.2 渔场管理
1. **查看渔场列表**
   - 登录后点击左侧菜单"渔场管理"
   - 系统显示所有可管理的渔场列表
   - 可通过搜索框按名称搜索渔场

2. **查看渔场详情**
   - 在渔场列表中点击目标渔场名称或"详情"按钮
   - 进入渔场详情页，可查看：
     - 渔场基本信息（位置、面积、类型等）
     - 实时水质数据（温度、pH值、溶氧量等）
     - 设备状态列表
     - 视频监控画面

3. **添加渔场**（管理员权限）
   - 点击渔场列表页"添加渔场"按钮
   - 填写渔场信息表单：
     - 基本信息：名称、类型、面积、地址
     - 位置信息：通过地图选择具体位置
     - 负责人信息：姓名、联系方式
   - 点击"保存"按钮完成添加

#### 9.2.3 设备管理
1. **查看设备列表**
   - 在渔场详情页点击"设备管理"标签
   - 或通过左侧菜单"设备管理"进入全局设备列表
   - 可查看设备名称、类型、状态、安装位置等信息

2. **控制设备**
   - 在设备列表中找到目标设备，点击"控制"按钮
   - 在弹出的控制面板中进行操作：
     - 开关控制：点击开关按钮切换设备状态
     - 参数调节：通过滑块或输入框设置设备参数
     - 高级设置：点击"高级"按钮进行更多配置
   - 点击"确认"按钮发送控制命令

3. **查看设备数据**
   - 在设备列表中点击设备名称或"数据"按钮
   - 进入设备数据页面，查看：
     - 实时数据：当前运行参数
     - 历史曲线：参数变化趋势图表
     - 数据报表：可按时间范围查询并导出

#### 9.2.4 常见问题
1. **无法登录系统**
   - 检查用户名和密码是否正确
   - 确认账号是否被禁用
   - 清除浏览器缓存后重试

2. **视频监控无法播放**
   - 检查网络连接
   - 确认摄像头设备在线
   - 更新浏览器至最新版本
   - 检查是否授予摄像头访问权限

3. **数据不更新**
   - 检查设备是否在线
   - 确认网络连接正常
   - 联系管理员检查数据采集服务

### 9.3 管理员手册
#### 9.3.1 系统管理
- **参数配置**：
  - 进入"系统设置"→"参数配置"
  - 可配置系统名称、logo、主题色等
  - 可设置数据采集频率、存储策略等
  - 点击"保存"使配置生效

- **日志管理**：
  - 进入"系统设置"→"日志管理"
  - 可查看用户操作日志、系统运行日志、错误日志
  - 支持按时间、用户、操作类型筛选
  - 可导出日志数据

#### 9.3.2 用户管理
- **用户列表**：
  - 进入"用户管理"→"用户列表"
  - 查看所有系统用户信息
  - 可进行启用/禁用、编辑、删除操作

- **角色管理**：
  - 进入"用户管理"→"角色管理"
  - 查看系统角色列表
  - 点击"创建角色"添加新角色
  - 为角色分配权限并保存

#### 9.3.3 系统维护
- **数据备份**：
  - 进入"系统维护"→"数据备份"
  - 点击"立即备份"手动触发备份
  - 可设置自动备份策略（每日/每周）
  - 可下载备份文件或删除历史备份

- **系统更新**：
  - 进入"系统维护"→"系统更新"
  - 查看当前版本和最新版本
  - 点击"检查更新"获取更新信息
  - 点击"更新系统"进行升级

## 10. 版本说明
### 10.1 版本历史
| 版本号 | 发布日期 | 更新内容 | 负责人 | 已知问题 |
|--------|----------|----------|--------|----------|
| V1.0.0 | 2025-05-15 | 初始版本，包含用户管理、渔场管理基础功能 | 钟坤原 | 视频监控偶发卡顿 |
| V1.1.0 | 2025-05-20 | 新增设备管理模块，优化数据展示 | 刘星宇 | 无重大问题 |
| V1.2.0 | 2025-05-30 | 新增预警系统，完善报表功能 | 崔扬 | 预警短信偶发延迟 |
| V2.0.0 | 2025-6-15 | 重构数据分析模块，支持大数据量处理 | 文雅竹 | 数据导出功能在Excel格式下有兼容性问题 |

### 10.2 升级指南
#### V1.x升级到V2.0.0
1. **升级准备**
   - 备份数据库：`mysqldump -u root -p fishfarm > backup_20231015.sql`
   - 备份配置文件：将`config`目录复制到安全位置
   - 检查服务器配置是否满足V2.0.0要求

2. **升级步骤**
   - 前端升级：
     ```bash
     cd frontend
     git pull
     npm install
     npm run build
     ```
   - 后端升级：
     ```bash
     cd backend
     git pull
     mvn clean package
     docker-compose down
     docker-compose up -d
     ```
   - 数据库升级：
     ```bash
     mysql -u root -p fishfarm < sql/update_v2.0.0.sql
     ```

3. **兼容性说明**
   - V2.0.0不兼容V1.x的数据模型，需执行升级脚本
   - 旧版API接口有部分变更，前端必须同步升级
   - 推荐先在测试环境验证升级后再应用到生产环境

### 10.3 发布计划
#### 短期计划（未来3个月）
- **V2.2.0**（2024-01-15）：
  - 新增移动端APP
  - 优化数据分析算法
  - 支持多语言切换

- **V2.3.0**（2024-02-28）：
  - 集成AI预测功能
  - 完善权限管理系统
  - 优化用户体验

#### 长期规划（未来6-12个月）
- 支持物联网设备自动发现
- 集成供应链管理模块
- 开发AI辅助决策系统
- 构建开放API平台
## 11. 附录
### 11.1 术语表
- 技术术语
- 业务术语
- 缩略语

### 11.2 参考资料
- 技术文档
- 标准规范
- 相关链接

### 11.3 联系信息
- 技术支持
- 问题反馈
- 社区资源

---

**文档维护说明：**
- 本文档应随项目开发进度持续更新
- 每个模块的详细内容需要相关负责人补充完善
- 建议定期审查和更新文档内容，确保与实际项目保持一致
- 文档版本控制应与代码版本控制同步管理